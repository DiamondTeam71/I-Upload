<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>I Upload — Upload Your Generation!</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Hind+Siliguri:wght@700&display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family:'Hind Siliguri','Poppins',sans-serif;}
body {display:flex; justify-content:center; align-items:center; height:100vh; background:url("https://i.ibb.co/T91cvMJ/blob.jpg") no-repeat center center fixed; background-size:cover;}
.container {width:90%; max-width:400px; max-height:80vh; background:rgba(255,255,255,0.95); padding:20px; border-radius:20px; box-shadow:0 15px 35px rgba(0,0,0,0.3); text-align:center; margin:0 10px; border:5px solid black; overflow-y:auto; -webkit-overflow-scrolling:touch;}
h2 {text-align:center; margin-bottom:10px; color:#333; background:yellow; padding:3px; margin:0 15px 15px 15px; border-radius:37px; border:5px solid black;}
input[type=file] {margin:15px 0; padding:8px; border-radius:37px; border:4px solid black; cursor:pointer; width:100%;}
button {padding:12px 20px; margin:10px 5px; border:4px solid black; border-radius:12px; background:linear-gradient(90deg,#ff6ec4,#7873f5); color:#fff; font-weight:700; font-size:16px; cursor:pointer; transition:0.3s;}
button:hover {transform:translateY(-2px); box-shadow:0 5px 15px rgba(0,0,0,0.3);}
#previewWrapper {position:relative; width:100%; max-height:300px; overflow:hidden; margin:15px auto; border-radius:nonepx; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
#preview {width:100%; display:block; touch-action:none;}
#linkContainer {display:none; margin-top:15px;}
#link {width:100%; padding:10px; border-radius:37px; border:4px solid black; margin-bottom:10px;}
#loader {display:none; margin-top:10px; font-weight:600; color:#ff6ec4;}
</style>
</head>
<body>
<div class="container">
<h2><i class="fas fa-upload"></i> I Upload — Upload Your Generation</h2>
<input type="file" id="fileInput" accept="image/*,.gif"><br>
<button id="toggleCropBtn"><i class="fas fa-crop"></i> Enable Crop</button>
<button id="uploadBtn"><i class="fas fa-upload"></i> Upload</button>
<div id="loader"><i class="fas fa-spinner fa-spin"></i> Uploading...</div>
<div id="previewWrapper"><img id="preview" src="" alt="এখানে প্রিভিউ দেখানো হবে!"></div>
<div id="linkContainer">
<input type="text" id="link" readonly>
<button id="copyBtn"><i class="fas fa-copy"></i> Copy Link</button>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script>
const fileInput = document.getElementById('fileInput');
const toggleCropBtn = document.getElementById('toggleCropBtn');
const uploadBtn = document.getElementById('uploadBtn');
const preview = document.getElementById('preview');
const previewWrapper = document.getElementById('previewWrapper');
const linkContainer = document.getElementById('linkContainer');
const linkInput = document.getElementById('link');
const copyBtn = document.getElementById('copyBtn');
const loader = document.getElementById('loader');
let cropper = null;
let cropEnabled = false;
const imgbbApiKey = 'ffa6fb5ad76979e8aa67715e5f1b1b93';

fileInput.addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = function(ev){
            preview.src = ev.target.result;
            preview.style.display='block';
            if(cropper){cropper.destroy(); cropper=null; cropEnabled=false; toggleCropBtn.innerHTML='<i class="fas fa-crop"></i> Enable Crop';}
        }
        reader.readAsDataURL(file);
    }
});

toggleCropBtn.addEventListener('click', ()=>{
    if(!preview.src) return alert("Please select an image first!");
    if(!cropEnabled){
        cropper = new Cropper(preview, {aspectRatio:1, viewMode:2, responsive:true, background:false, autoCropArea:1});
        cropEnabled = true;
        toggleCropBtn.innerHTML = '<i class="fas fa-eye-slash"></i> Hide Crop';
    } else {
        cropper.destroy();
        cropper = null;
        cropEnabled = false;
        toggleCropBtn.innerHTML = '<i class="fas fa-crop"></i> Enable Crop';
    }
});

uploadBtn.addEventListener('click', async ()=>{
    if(!preview.src) return alert("Please select an image!");
    let blob;
    if(cropEnabled && cropper){
        blob = await new Promise(res=>cropper.getCroppedCanvas().toBlob(res,'image/png'));
    } else {
        const response = await fetch(preview.src);
        blob = await response.blob();
    }
    const formData = new FormData();
    formData.append("image",blob);
    loader.style.display='block';
    try{
        const res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`,{method:"POST",body:formData});
        const data = await res.json();
        if(data.success){
            linkInput.value=data.data.url;
            linkContainer.style.display='block';
        }else{alert("Upload failed!");}
    }catch(err){alert("Error uploading: "+err.message);}
    finally{loader.style.display='none';}
});

copyBtn.addEventListener('click', ()=>{
    linkInput.select();
    linkInput.setSelectionRange(0,99999);
    navigator.clipboard.writeText(linkInput.value);
    alert("Link copied!");
});
</script>
</body>
  </html>
